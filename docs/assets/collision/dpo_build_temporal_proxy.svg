<svg xmlns="http://www.w3.org/2000/svg" width="960" height="360" viewBox="0 0 960 360">
  <defs>
    <style>
      :root { --bg:#0b1020; --panel:#121a33; --text:#dfe7ff; --muted:#9fb0d6; --edge:#6aa0ff; --k:#ffd166; --added:#00c853; --removed:#ff5252; --scope:#ffa600; }
      .panel { fill: var(--panel); rx: 8px; }
      .title { fill: var(--text); font-weight: 600; font-size: 16px; }
      .caption { fill: var(--muted); font-size: 12px; }
      .node rect { fill:#182347; stroke:#3356a6; stroke-width:1.2; rx:6px; }
      .node.interfaceK rect { fill:#2b2746; stroke:var(--k); stroke-width:2; }
      .node.added rect { fill:#0d2a1a; stroke:var(--added); stroke-width:2; }
      .node.removed rect { fill:#2a0d0d; stroke:var(--removed); stroke-width:2; }
      .node text { fill:var(--text); font-size:12px; }
      .edge line, .edge path { stroke:var(--edge); stroke-width:1.6; fill:none; }
      .edge.added line, .edge.added path { stroke:var(--added); stroke-width:2; }
      .edge.removed line, .edge.removed path { stroke:var(--removed); stroke-width:2; }
      .edge text { fill:var(--muted); font-size:11px; }
      .scope rect { fill:none; stroke:var(--scope); stroke-width:2; stroke-dasharray:6 4; rx:8px; }
      .label { fill:var(--text); font-size:13px; }
    </style>
    <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerUnits="strokeWidth" markerWidth="7" markerHeight="7" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" fill="#6aa0ff"/></marker>
  </defs>
  <rect x="0" y="0" width="960" height="360" fill="var(--bg)"/>
  <text class="title" x="24" y="28">DPO: BuildTemporalProxy (pre_update)</text>
  <text class="caption" x="24" y="46">LHS: Collider+Transform(+Velocity) at Tick n; RHS: add TemporalProxy(e,n) with fat AABB; K: Collider, Transform, Tick</text>

  <!-- Panels -->
  <rect class="panel" x="24" y="64" width="408" height="264"/>
  <text class="label" x="36" y="86">LHS</text>
  <rect class="panel" x="528" y="64" width="408" height="264"/>
  <text class="label" x="540" y="86">RHS</text>

  <!-- LHS nodes -->
  <g class="node interfaceK" transform="translate(56,120)"><rect width="120" height="36"/><text x="8" y="22">Collider(e)</text></g>
  <g class="node interfaceK" transform="translate(56,170)"><rect width="140" height="36"/><text x="8" y="22">Transform(e,n)</text></g>
  <g class="node" transform="translate(56,220)"><rect width="120" height="36"/><text x="8" y="22">Velocity(e)</text></g>
  <g class="node interfaceK" transform="translate(236,120)"><rect width="90" height="36"/><text x="8" y="22">Tick(n)</text></g>

  <!-- LHS edges -->
  <g class="edge" >
    <line x1="176" y1="138" x2="236" y2="138" marker-end="url(#arrow)"/>
    <text x="190" y="130">produced_in</text>
  </g>
  <g class="edge">
    <line x1="176" y1="188" x2="236" y2="188" marker-end="url(#arrow)"/>
    <text x="188" y="180">at</text>
  </g>

  <!-- RHS nodes (K carried over) -->
  <g class="node interfaceK" transform="translate(560,120)"><rect width="120" height="36"/><text x="8" y="22">Collider(e)</text></g>
  <g class="node interfaceK" transform="translate(560,170)"><rect width="140" height="36"/><text x="8" y="22">Transform(e,n)</text></g>
  <g class="node interfaceK" transform="translate(560,220)"><rect width="90" height="36"/><text x="8" y="22">Tick(n)</text></g>

  <!-- Added proxy -->
  <g class="node added pulse-add" transform="translate(740,160)"><rect width="172" height="44"/><text x="8" y="26">TemporalProxy(e,n)</text></g>
  <g class="edge added">
    <line x1="680" y1="188" x2="740" y2="182" marker-end="url(#arrow)"/>
    <text x="684" y="172">has_proxy</text>
  </g>
  <g class="edge added">
    <line x1="740" y1="204" x2="612" y2="238" marker-end="url(#arrow)"/>
    <text x="650" y="244">produced_in</text>
  </g>

  <!-- Scope (entity e) -->
  <g class="scope"><rect x="44" y="108" width="372" height="160"/></g>
  <g class="scope"><rect x="548" y="108" width="372" height="160"/></g>
</svg>
